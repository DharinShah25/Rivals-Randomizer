// discord_spinteam_bot
// Requirements: Node.js + discord.js v14

import { Client, GatewayIntentBits, SlashCommandBuilder, REST, Routes } from 'discord.js';
import dotenv from 'dotenv';
dotenv.config();

const client = new Client({ intents: [GatewayIntentBits.Guilds] });

const characters = [
  "Captain America", "Doctor Strange", "Emma Frost", "Groot", "Hulk", "Magneto", "Peni Parker",
  "The Thing", "Thor", "Venom", "Black Panther", "Black Widow", "Hawkeye", "Hela", "Human Torch",
  "Iron Fist", "Iron Man", "Magik", "Mister Fantastic", "Moon Knight", "Namor", "Psylocke",
  "Scarlet Witch", "Spider-Man", "Squirrel Girl", "Star-Lord", "Storm", "The Punisher",
  "Winter Soldier", "Wolverine", "Adam Warlock", "Cloak & Dagger", "Invisible Woman",
  "Jeff the Land Shark", "Loki", "Luna Snow", "Mantis", "Rocket Raccoon", "Ultron"
];

function getRandomCharacters(count = 3) {
  const shuffled = characters.sort(() => 0.5 - Math.random());
  return shuffled.slice(0, count);
}

client.once('ready', () => {
  console.log(`ğŸ¤– Logged in as ${client.user.tag}`);
});

client.on('interactionCreate', async interaction => {
  if (!interaction.isChatInputCommand()) return;
  if (interaction.commandName === 'spinteam') {
    const [char1, char2, char3] = getRandomCharacters();
    await interaction.reply(
      `ğŸ® **Team Spin Results:**\nPlayer 1 â€“ ${char1}\nPlayer 2 â€“ ${char2}\nPlayer 3 â€“ ${char3}`
    );
  }
});

// Register the slash command
const commands = [
  new SlashCommandBuilder()
    .setName('spinteam')
    .setDescription('Assigns 3 random characters to 3 players')
    .toJSON()
];

const rest = new REST({ version: '10' }).setToken(process.env.BOT_TOKEN);

(async () => {
  try {
    console.log('ğŸ“¡ Registering slash commands...');
    await rest.put(
      Routes.applicationCommands(process.env.CLIENT_ID),
      { body: commands }
    );
    console.log('âœ… Slash commands registered.');
  } catch (error) {
    console.error('âŒ Error registering commands:', error);
  }
})();

client.login(process.env.BOT_TOKEN);
